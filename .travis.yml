language: cpp

# We want to run the `*_severe` debug and test targets; thus, we need
# g++ >= 4.9 and clang++ >= 3.5
compiler:
  - clang
  - gcc

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - gcc-4.9
      - g++-4.9

before_install:
  - if [[ $CXX = g++ ]]; then export CXX="g++-4.9" CC="gcc-4.9"; fi

script:
  # compile and run optimized binary
  - make clean bin bint_run
  # compile and run debug binary
  - make clean bin_debug_severe bint_run
  # compile and run (severe) unit tests
  - make clean test_severe test_run
  # determine code coverage of unit tests
  - make clean cov test_run

after_success:
  - bash <(curl -s https://codecov.io/bash) || echo "Codecov did not collect coverage reports"
  # clean up
  - make clean
